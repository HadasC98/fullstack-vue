(function(){"use strict";var t={5678:function(t,e,o){var r=o(5130),s=o(6768),n=o(4232);const a={id:"app"},i={class:"cart"},c={class:"controls"},u={key:0,class:"no-products"},l={key:1,class:"product-list"},d=["src","alt"],p={key:0,class:"low-stock"},h={class:"cart-buttons"},k=["disabled","onClick"],m=["disabled","onClick"],f=["disabled"],b={key:2,class:"checkout-area"},v=["src","alt"],L=["onUpdate:modelValue","max","onChange"],y={class:"cart-buttons"},C=["onClick"],P={key:3,class:"user-form-overlay"},g={class:"user-form-container"},w=["disabled"];function F(t,e,o,F,O,_){return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.Lk)("header",null,[e[11]||(e[11]=(0,s.Lk)("h1",null,"Lessons Shop",-1)),(0,s.Lk)("div",i,[(0,s.Lk)("span",null,"ðŸ›’ Cart: "+(0,n.v_)(_.cartItemCount)+" items",1)])]),(0,s.Lk)("div",c,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>O.searchQuery=t),placeholder:"Search lessons...",class:"search-bar"},null,512),[[r.Jo,O.searchQuery]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>O.sortOption=t),class:"sort-select"},e[12]||(e[12]=[(0,s.Fv)('<option disabled value="" data-v-7c2791d2>Sort by</option><option value="subject" data-v-7c2791d2>Subject (A-Z)</option><option value="location" data-v-7c2791d2>Location (A-Z)</option><option value="priceAsc" data-v-7c2791d2>Price (Low to High)</option><option value="stockAsc" data-v-7c2791d2>Availability (Low to High)</option>',5)]),512),[[r.u1,O.sortOption]])]),0===O.products.length?((0,s.uX)(),(0,s.CE)("div",u,e[13]||(e[13]=[(0,s.Lk)("p",null,"No lessons available at the moment.",-1)]))):(0,s.Q3)("",!0),O.showProductList?((0,s.uX)(),(0,s.CE)("div",l,[e[14]||(e[14]=(0,s.Lk)("h2",null,"Products",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(_.sortedAndFilteredProducts,(t=>((0,s.uX)(),(0,s.CE)("div",{key:t._id,class:"product"},[(0,s.Lk)("h3",null,(0,n.v_)(t.subject),1),(0,s.Lk)("img",{src:t.imagePath,alt:t.imageAlt,class:"product-image"},null,8,d),(0,s.Lk)("p",null,"Location: "+(0,n.v_)(t.location),1),(0,s.Lk)("p",null,"Price: $"+(0,n.v_)(t.price),1),(0,s.Lk)("p",null,[(0,s.eW)("Available: "+(0,n.v_)(t.stock)+" ",1),t.stock<=2?((0,s.uX)(),(0,s.CE)("span",p,"Low stock!")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",h,[(0,s.Lk)("button",{disabled:0===t.stock,onClick:e=>_.addToCart(t)}," Add to Cart ",8,k),(0,s.Lk)("button",{disabled:!_.isInCart(t),onClick:e=>_.removeFromCart(t)}," Remove from Cart ",8,m)])])))),128)),(0,s.Lk)("button",{onClick:e[2]||(e[2]=(...t)=>_.goToCheckout&&_.goToCheckout(...t)),disabled:0===_.cartItemCount,class:"checkout-btn"}," Go to Checkout ",8,f)])):(0,s.Q3)("",!0),O.showCheckoutPopup&&!O.showUserForm?((0,s.uX)(),(0,s.CE)("div",b,[e[19]||(e[19]=(0,s.Lk)("h2",null,"Checkout",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(O.cart,((o,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"cart-item"},[(0,s.Lk)("h3",null,(0,n.v_)(o.subject),1),(0,s.Lk)("img",{src:o.imagePath,alt:o.imageAlt,class:"cart-image"},null,8,v),(0,s.Lk)("p",null,[e[15]||(e[15]=(0,s.Lk)("strong",null,"Price:",-1)),(0,s.eW)(" $"+(0,n.v_)(o.price),1)]),(0,s.Lk)("p",null,[e[16]||(e[16]=(0,s.Lk)("strong",null,"Quantity:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>o.quantity=t,min:"1",max:o.stock,onChange:e=>t.updateCart(a)},null,40,L),[[r.Jo,o.quantity,void 0,{number:!0}]])]),(0,s.Lk)("p",null,[e[17]||(e[17]=(0,s.Lk)("strong",null,"Subtotal:",-1)),(0,s.eW)(" $"+(0,n.v_)((o.price*o.quantity).toFixed(2)),1)]),(0,s.Lk)("div",y,[(0,s.Lk)("button",{onClick:t=>_.removeFromCart(o,o.quantity)},"Remove",8,C)])])))),128)),(0,s.Lk)("p",null,[e[18]||(e[18]=(0,s.Lk)("strong",null,"Total Price:",-1)),(0,s.eW)(" $"+(0,n.v_)(_.totalPrice.toFixed(2)),1)]),(0,s.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>_.goBackToProducts&&_.goBackToProducts(...t)),class:"back-btn"},"Back to Products"),(0,s.Lk)("button",{onClick:e[4]||(e[4]=(...t)=>_.showUserFormPopup&&_.showUserFormPopup(...t)),class:"finalize-btn"}," Finalize Order ")])):(0,s.Q3)("",!0),O.showUserForm?((0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("div",g,[e[24]||(e[24]=(0,s.Lk)("h2",null,"Enter Your Details",-1)),(0,s.Lk)("form",{onSubmit:e[10]||(e[10]=(0,r.D$)(((...t)=>_.finalizeOrder&&_.finalizeOrder(...t)),["prevent"]))},[e[20]||(e[20]=(0,s.Lk)("label",{for:"name"},"Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"name","onUpdate:modelValue":e[5]||(e[5]=t=>O.user.name=t),required:""},null,512),[[r.Jo,O.user.name]]),e[21]||(e[21]=(0,s.Lk)("label",{for:"phone"},"Phone",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"phone","onUpdate:modelValue":e[6]||(e[6]=t=>O.user.phone=t),required:""},null,512),[[r.Jo,O.user.phone]]),e[22]||(e[22]=(0,s.Lk)("label",{for:"email"},"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":e[7]||(e[7]=t=>O.user.email=t),required:""},null,512),[[r.Jo,O.user.email]]),e[23]||(e[23]=(0,s.Lk)("label",{for:"address"},"Address",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"address","onUpdate:modelValue":e[8]||(e[8]=t=>O.user.address=t),required:""},null,512),[[r.Jo,O.user.address]]),(0,s.Lk)("button",{type:"submit",disabled:!_.isFormValid},"Submit Order",8,w),(0,s.Lk)("button",{onClick:e[9]||(e[9]=(...t)=>_.closeUserFormPopup&&_.closeUserFormPopup(...t))},"Cancel")],32)])])):(0,s.Q3)("",!0)])}o(4114),o(8992),o(4520),o(2577),o(1454),o(8872),o(7550);var O={data(){return{products:[],cart:[],user:{name:"",phone:"",email:"",address:""},searchQuery:"",sortOption:"",showCheckoutPopup:!1,showProductList:!0,showUserForm:!1}},mounted(){this.fetchProducts()},methods:{async fetchProducts(){try{const t=await fetch("https://fullstack-express-9dbh.onrender.com/api/lessons");if(!t.ok)throw new Error("Failed to fetch lessons");const e=await t.json();console.log("Lessons fetched:",e),this.products=e}catch(t){console.error("Error fetching products:",t),alert("Error fetching products")}},addToCart(t){const e=this.cart.find((e=>e._id===t._id));e?e.quantity++:this.cart.push({...t,quantity:1}),t.stock--,this.updateProductStock(t)},async updateProductStock(t){try{await fetch(`https://fullstack-express-9dbh.onrender.com/api/lessons/${t._id}/update-stock`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:-1})})}catch(e){console.error(`Error updating stock for ${t.subject}:`,e)}},removeFromCart(t,e=1){const o=this.cart.findIndex((e=>e._id===t._id));if(o>=0){const r=this.cart[o];r.quantity>e?r.quantity-=e:this.cart.splice(o,1),t.stock+=e,this.updateProductStock(t)}},goToCheckout(){this.showProductList=!1,this.showCheckoutPopup=!0},goBackToProducts(){this.showProductList=!0,this.showCheckoutPopup=!1},showUserFormPopup(){this.showUserForm=!0},closeUserFormPopup(){this.showUserForm=!1},async finalizeOrder(){const t=this.cart.map((t=>t._id)),e=this.cart.map((t=>t.quantity)),o={name:this.user.name,phoneNumber:this.user.phone,email:this.user.email,address:this.user.address,lessonIDs:t,numberOfSpaces:e};try{const t=await fetch("https://fullstack-express-9dbh.onrender.com/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});t.ok?(await fetch("https://fullstack-express-9dbh.onrender.com/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.user.name,phoneNumber:this.user.phone})}),this.cart=[],this.user={name:"",phone:"",email:"",address:""},this.fetchProducts(),alert("Order placed successfully!")):alert("Failed to place the order")}catch(r){console.error("Error finalizing order:",r)}},isInCart(t){return this.cart.some((e=>e._id===t._id))},isFormValid(){const t=/^[A-Za-z]+$/,e=/^[0-9]+$/;return t.test(this.user.name)&&e.test(this.user.phone)}},computed:{cartItemCount(){return this.cart.reduce(((t,e)=>t+e.quantity),0)},totalPrice(){return this.cart.reduce(((t,e)=>t+e.price*e.quantity),0)},sortedAndFilteredProducts(){let t=this.products.filter((t=>t.subject.toLowerCase().includes(this.searchQuery.toLowerCase())));switch(this.sortOption){case"subject":t.sort(((t,e)=>t.subject.localeCompare(e.subject)));break;case"location":t.sort(((t,e)=>t.location.localeCompare(e.location)));break;case"priceAsc":t.sort(((t,e)=>t.price-e.price));break;case"stockAsc":t.sort(((t,e)=>t.stock-e.stock));break}return t}}},_=o(1241);const j=(0,_.A)(O,[["render",F],["__scopeId","data-v-7c2791d2"]]);var E=j;(0,r.Ef)(E).mount("#app")}},e={};function o(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,o),n.exports}o.m=t,function(){var t=[];o.O=function(e,r,s,n){if(!r){var a=1/0;for(l=0;l<t.length;l++){r=t[l][0],s=t[l][1],n=t[l][2];for(var i=!0,c=0;c<r.length;c++)(!1&n||a>=n)&&Object.keys(o.O).every((function(t){return o.O[t](r[c])}))?r.splice(c--,1):(i=!1,n<a&&(a=n));if(i){t.splice(l--,1);var u=s();void 0!==u&&(e=u)}}return e}n=n||0;for(var l=t.length;l>0&&t[l-1][2]>n;l--)t[l]=t[l-1];t[l]=[r,s,n]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};o.O.j=function(e){return 0===t[e]};var e=function(e,r){var s,n,a=r[0],i=r[1],c=r[2],u=0;if(a.some((function(e){return 0!==t[e]}))){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(c)var l=c(o)}for(e&&e(r);u<a.length;u++)n=a[u],o.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return o.O(l)},r=self["webpackChunklesson_shop"]=self["webpackChunklesson_shop"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=o.O(void 0,[504],(function(){return o(5678)}));r=o.O(r)})();
//# sourceMappingURL=app.06517c0d.js.map